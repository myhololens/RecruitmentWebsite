function getObjectURL(file) {
    var url = null ;
    if (window.createObjectURL!=undefined) { // basic
        url = window.createObjectURL(file) ;
    } else if (window.URL!=undefined) { // mozilla(firefox)
        url = window.URL.createObjectURL(file) ;
    } else if (window.webkitURL!=undefined) { // webkit or chrome
        url = window.webkitURL.createObjectURL(file) ;
    }
    return url ;
}

function check_img0() {
    $("#Img_0").change(function(){
        var objUrl = getObjectURL(this.files[0]) ;
        if (objUrl) {
            $("#proImg_0").attr("src", objUrl).css("display",'inline');
        };
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        var formData = new FormData();
        formData.append('file', $('#Img_0')[0].files[0]);
        $.ajax({
            url: '/upload/picture',
            type: 'post',
            cache: false,
            data: formData,
            processData: false,
            contentType: false
        }).done(function(res) {
            console.info(res);
            $('#proPicture_0').val(res.file);
        }).fail(function(res) {});
    })
}

function check_img1() {
    $("#Img_1").change(function(){
        var objUrl = getObjectURL(this.files[0]) ;
        if (objUrl) {
            $("#proImg_1").attr("src", objUrl).css("display",'inline');
        };
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        var formData = new FormData();
        formData.append('file', $('#Img_1')[0].files[0]);
        $.ajax({
            url: '/upload/picture',
            type: 'post',
            cache: false,
            data: formData,
            processData: false,
            contentType: false
        }).done(function(res) {
            console.info(res)
            $('#proPicture_1').val(res.file);
        }).fail(function(res) {});
    })
}

function check_img2() {
    $("#Img_2").change(function(){
        var objUrl = getObjectURL(this.files[0]) ;
        if (objUrl) {
            $("#proImg_2").attr("src", objUrl).css("display",'inline');
        };
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        var formData = new FormData();
        formData.append('file', $('#Img_2')[0].files[0]);
        $.ajax({
            url: '/upload/picture',
            type: 'post',
            cache: false,
            data: formData,
            processData: false,
            contentType: false
        }).done(function(res) {
            console.info(res)
            $('#proPicture_2').val(res.file);
        }).fail(function(res) {});
    })
}


$(function () {
    var a=1;
    $("#addMember").click(function () {
        if(a<3) {
            $("#productForm0").append(
                '<div id="productDiv'+a+'"> <div class="formWrapper"> <h3>产品海报</h3> <br> ' +
                '<input type="file" id="Img_'+a+'" name="Img_'+a+'" accept="image/png,image/jpg,image/jpeg,image/gif" onclick="check_img'+a+'()"> <br><br> ' +
                '<img src="" id="proImg_'+a+'" width="240" height="120" style="display: none">' +
                ' <input type="hidden" value="" name="image_'+a+'" id="proPicture_'+a+'"> <h3>产品名称</h3>' +
                ' <input type="text" placeholder="请输入产品名称" name="proName_'+a+'" id="proName'+a+'"> <h3>产品地址</h3>' +
                ' <input type="text" placeholder="请输入产品主页URL或产品下载地址" name="link_'+a+'" id="proAddress'+a+'"> ' + '<h3>产品简介</h3> ' +
                '<textarea placeholder="请简短描述该产品定位、产品特色、用户群体等" maxlength="1000" name="desc_'+a+'" id="proProfile_'+a+'"></textarea> ' +
                '</div> </div> <div class="clear" style="width: 100%;margin-top:30px;border-bottom: 1px solid silver"></div>');
            a++;
            if(a>2){
                $("#addMember").hide();
            }
        }
    });
    $("#step4Submit").click(function (){
        $("#productForm0").submit();
    })
});